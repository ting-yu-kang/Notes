# 772. Basic Calculator III
#### Also
[0227. Basic Calculator II](./0227.Basic_Calculator_II.md)

#### [link](https://leetcode.com/problems/basic-calculator-iii/)

#### Description
Implement a basic calculator to evaluate a simple expression string.

The expression string contains only non-negative integers, `'+'`, `'-'`, `'*'`, `'/'` operators, and open `'('` and closing parentheses `')'`. The integer division should **truncate toward zero**.

You may assume that the given expression is always valid. All intermediate results will be in the range of `[-2^31, 2^31 - 1]`.

**Note:** You are not allowed to use any built-in function which evaluates strings as mathematical expressions, such as `eval()`.

#### Example 1:
```
Input: s = "1+1"
Output: 2
```
#### Example 2:
```
Input: s = "6-4/2"
Output: 4
```
#### Example 3:
```
Input: s = "2*(5+5*2)/3+(6/2+8)"
Output: 21
```

#### Constraints:
* `1 <= s <= 10^4`
* `s` consists of digits, `'+'`, `'-'`, `'*'`, `'/'`, `'('`, and `')'`.
* `s` is a **valid** expression.

## Solution
```python
class Solution:
    def calculate(self, s: str) -> int:
        s += "#"
        return self._evaluation(s, 0)

    def _evaluation(self, s, start):
        stack = []
        sign = "+"
        num = 0

        def helper():
            match sign:
                case "+":
                    stack.append(num)
                case "-":
                    stack.append(-num)
                case "*":
                    prev = stack.pop()
                    stack.append(prev * num)
                case "/":
                    prev = stack.pop()
                    stack.append(int(prev / num))
        
        i = start
        while i < len(s):
            c = s[i]
            if c.isdigit():
                num = num * 10 + int(c)
            elif c in "+-*/#":
                helper()
                num = 0
                sign = c
            elif c == "(":
                i, num = self._evaluation(s, i + 1)
            elif c == ")":
                helper()
                return i, sum(stack)
            i += 1

        return sum(stack)
```
### Time complexity
* O(n)
### Space complexity
* O(n)
### Remark
* Throw everything to recursion when seeing `"("`

## Stack
```python
class Solution:
    def calculate(self, s: str) -> int:
        stack = []
        num = 0
        sign = "+"
        s += "#"

        def evaluate():
            if sign == "+":
                stack.append(num)
            elif sign == "-":
                stack.append(-num)
            elif sign == "*":
                stack.append(stack.pop() * num)
            else:
                stack.append(int(stack.pop() / num))

        for i in range(len(s)):
            c = s[i]
            if c.isdigit():
                num = num * 10 + int(c)
            elif c == "(":
                stack.append(sign)
                sign = "+"
            elif c == ")":
                evaluate()
                total = 0
                while isinstance(stack[-1], int):
                    total += stack.pop()
                sign = stack.pop()
                num = total
            else:
                evaluate()
                sign = c
                num = 0

        return sum(stack)
```
### Time complexity
* O(n)
### Space complexity
* O(n)
### Remark
* Push sign in the stack when encountering "("